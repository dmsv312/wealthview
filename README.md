# WealthView — обзор кода

WealthView — проект на Django 2.2 с рабочими Celery и небольшим статическим фронтом. Код
организован вокруг Django-приложений, которые разделяют управление аккаунтом, портфельную
аналитику, контент и API для исторических данных.

## Структура верхнего уровня

- **docker-compose-*.yml** — описания сервисов для локальной, dev- и prod-сред.
- **web/** — основной код Django и все внутренние приложения.
- **postgre/**, **start/**, **supervisor/** — скрипты и конфигурации контейнеров, БД и
  процессов (Gunicorn, Celery, миграции, bootstrap).

## Django-проект (`web/`)

- **manage.py** — стандартная точка входа.
- **WealthView/** — конфигурация проекта:
  - `settings.py` подключает приложения, middleware, Celery и внешние сервисы (EOD,
    Sentry, TinyMCE, Telegram-бот и пр.).
  - `urls.py` собирает публичный сайт, API, TinyMCE и Django admin.
  - `celery.py`, `bot.py` — настройка Celery-воркера и вспомогательных функций Telegram.
  - `utils.py` — общие утилиты (генерация slug, пути к медиа и т. п.).

### Базовые доменные приложения

- **backtest/** — ядро инвестиционного движка: модели валют, бирж, активов, котировок
  (`AssetsPrices`), сплитов и корпоративных действий, кастомный admin, Celery-задачи для
  парсинга и перерасчёта данных. Вьюхи дают страницы бэктестов, `analyze.py` — аналитика
  портфеля, переиспользуемая аккаунтом.
- **account/** — управление пользователями и портфелями (`Profile`, `Portfolio`,
  `Operation`), DRF-сериализаторы, HTML-формы импорта операций, кэш и `AnalyzeMixin` для
  аналитики. Содержит личный кабинет и уведомления в Telegram.
- **algorithm/** — количественные утилиты: риск-профилирование (`risk_profile.py`),
  оценщики активов и MVP-скрипты бэктестов, используемые cron-задачами и личным кабинетом.
- **api/** — REST API на Django REST Framework: `/api/assets/` и другие эндпоинты с
  фильтрами по датам, агрегации и биржам (см. `AssetViewset` и сериализаторы).
- **rprofile/** — хранит анкеты и вьюхи для мастера риск-профиля на публичном сайте.

### Контент и презентация

- **main/** — лендинг и общий контекст (страны, статические страницы).
- **articles/** — блог с фильтрами, списком/детальными страницами и TinyMCE в админке; в
  `query_tools` используются фильтры статуса публикаций.
- **faq/** — модели и вьюхи FAQ.
- **reviews/** — модуль отзывов (модели, формы, фильтры), подключаемый через `urls.py`.
- **query_tools/** — общие утилиты выборок (сортировка, даты, публикационный статус) для
  контентных приложений.
- **core/** — проектный «клей»: middleware, контекст-процессоры, Celery-задачи и внешние
  интеграции (например, обёртка EOD). В `utils/` есть хелперы пагинации.
- **auth_sys/** — кастомная аутентификация: логин по email, восстановление пароля, токены
  Telegram и связанные URL.

### Статика и шаблоны

- **static/** — собранные CSS/JS и изображения для маркетинговых страниц и личного
  кабинета.
- **templates/** — шаблоны Django для лендинга, дашборда портфеля, статей, FAQ и других
  страниц. Используют контекст-процессоры из `core` и переиспользуемые сниппеты.

### Фоновые задачи

- **backtest/tasks.py**, **account/tasks.py** и конфигурация Celery beat в `supervisor/`
  отвечают за обновление рыночных данных, перерасчёт аналитики портфелей, Telegram-дайджесты
  и пересчёт атрибутов активов после сплитов.

## Сопутствующие сервисы

- **postgre/** — SQL-скрипты и helper'ы миграций для контейнера PostgreSQL.
- **start/** — entrypoint-скрипты Docker (collectstatic, migrate, запуск сервера).
- **supervisor/** — конфиги Supervisor для Gunicorn, Celery-воркеров и beat в продакшене.

Этот краткий обзор поможет быстро сориентироваться, где находятся API, фоновые задачи и
презентационные слои проекта WealthView.
